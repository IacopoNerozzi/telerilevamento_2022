### Land Cover ###

#Codice in cui genereremo immagini land cover da immagini satellitari

library(raster)
library(RStoolbox)
#contiene le funzioni per la classificazione
setwd("C:/lab/")
#set working directory

#lavorerò di nuovo con le immagini satellitari del Rio Pexoto, con la deforestazione avvenuta fra il 1992 e il 2006
l1992 <- brick("defor1_.jpg")
#l1992 mi ricorda che è un landset del 1992
#mi dava errore "file non esistente" non avevo lanciato il comando di working directory
C
#non importa che riscriva r=, ecc
l2006 <- brick("defor2_.jpg")
plotRGB(l2006, 1,2,3, stretch="lin")
#ho importato anche il secondo file

par(mfrow=c(2,1))
plotRGB(l1992, 1,2,3, stretch="lin")
plotRGB(l2006, 1,2,3, stretch="lin")
dev.off()
#le visualizzo insieme, per un confronto

install.packages("ggplot2")
library(ggplot2)

#creo un multiframe con ggplot2
par(mfrow=c(2,1))
ggRGB(l1992, 1,2,3, stretch="lin")
ggRGB(l2006, 1,2,3, stretch="lin")
#non andava la funzione RGB, di nuovo dimenticato di caricare RStoolbox
dev.off()

#guardando l'immagine del 92 c'è poca differenza fra suolo nudo e acqua, questo perchè l'acqua non è pura ma contiene molto detrito
#possiamo quindi fare due classi
#a cosa serve classificare? posso poi mettere a confronto le due classi nelle due immagini
#posso avere un valore della porzione di terreno che da foresta è passato ad agricolo

#classificazione
l1992c <- unsuperClass(l1992, nClasses=2)
#associo il modello della classificazione all'oggetto
#aggiungo c per ricordarmi che è classificato
l1992c
#è un raster layer
#il n di px è lo stesso del n di px in entrata
#non consideriamo la risoluzione, essendo già elaborata
#il numero di valori dell'immagine classificata è 1 o 2, non 255 dell'immagine a 8bit
plot(l1992c)
#mi da errore volendolo plottare, è normale
#dicendo "does not have components 'x' and 'y'" dice che non è una mappa, ma un modello
#al mio modello è legata una mappa con il segno del dollaro
#devo farlo anche io con il comando
plot(l1992c$map)
#lego quindi la mappa al modello e lo plotto

#nella classificazione il nome del modello viene scelto dal software, per questo i colori possono variare fra operatori (noi studenti)
#nel mio caso:
#class 1: Forest. bianco
#Class 2: Agriculture + Water, verde

#Esercizio: classificare anche la seconda immagine
l2006
l2006c <- unsuperClass(l2006, nClasses=2)
l2006c
plot(l2006c$map)
#nel mio caso:
#class 1: Forest. bianco
#Class 2: Agriculture + Water, verde

#Frequenze
install.packages("questionr")

freq(l1992c$map)
#restituisce le frquenze delle due classi
#cosa sono i numeri? il numero di pixel delle due classi
#class 1: 306012
#class 2: 35280
freq(l2006c$map)
#class 1: 164480
#class 2: 178246

library(patchwork)
#compositore di plot
#l'idea è quella di considerare i plot come oggetti, dopodichè metterli in fila e li somma
#con la funzione ggRGB abbiamo creato due plot
#possiamo quindi associare la funzione a due oggetti per poi comporli
p1 <- ggRGB(l1992, 1,2,3, stretch="lin")
p2 <- ggRGB(l2006, 1,2,3, stretch="lin")

p1 + p2
#unione dei due plot
# e se volessi metterli uno sopra l'altro?
p1/p2
#uso la frazione
